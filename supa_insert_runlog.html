<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
    const SUPABASE_URL = 'https://orfkcwmcwmsdtjsfevhl.supabase.co';
    const SUPABASE_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im9yZmtjd21jd21zZHRqc2ZldmhsIiwicm9sZSI6InNlcnZpY2Vfcm9sZSIsImlhdCI6MTc0MzA0NDg4NSwiZXhwIjoyMDU4NjIwODg1fQ.47UfZBPsVIy29PPXorOC7s2iwK1rJESRZeCtNsg8b7s';

    function initSupabase() {
        try {
            return window.supabase.createClient(SUPABASE_URL, SUPABASE_KEY);
        } catch (error) {
            alert("连接服务器失败！");
            return null;
        }
    }

    async function insertData(client) {
        try {
            let currentDateTime = new Date().toString();
            const { data, error } = await client
                  .from('runlog')
                  .insert({prgname:'dukaqi',runtime:currentDateTime})
                  .select(); // 显式要求返回数据
                   console.log('data', data);

            if (error) throw error;
            return data;
        } catch (error) {
        console.error("插入数据失败:", error.message);
        throw error; // 重新抛出错误，让外层捕获
            return null;
        }
    }

    function renderData(data) {
        document.write(`<p>数据已写入！</p><pre>${JSON.stringify(data, null, 2)}</pre>`);
    }

    (async () => {
        const client = initSupabase();
        if (!client) return;
        try {
            const data = await insertData(client);
            if (data) renderData(data);
        } catch (error) {
            document.write(`Error: ${error.message}`);
        }
    })();
</script>
